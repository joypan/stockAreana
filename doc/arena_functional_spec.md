# Stock Analyst Arena - 系統需求規格書 (SRS)

## 1. 目標與背景 (Goal & Context)

- **目標**：建立一個「AI 股票分析師競技場」平台，讓使用者可以設定具備不同人設的 AI 分析師，針對特定股票議題進行多輪獨立與互動式分析，最後由 AI 裁判給出綜合結論。
- **背景**：在股票市場中，單一分析師的觀點可能存在偏誤。透過「群體智慧」與「對抗式討論」，使用者可以從多個維度（如價值投資、技術分析、宏觀分析等）全面理解議題，並透過 AI 裁判過濾雜訊。

## 2. 參與角色 (Actors)

- **使用者 (User)**：負責設定分析師團隊、發起競技任務、輸入分析主題，並查看最終分析結果的人員。
- **AI 分析師 (AI Analysts)**：由 LLM 驅動的虛擬角色，根據設定的系統指令（System Prompt）執行獨立分析與交互參考分析。
- **AI 裁判 (AI Judge)**：負責彙整所有分析師觀點並給出最終建議的 LLM。

## 3. 功能需求 (Functional Requirements)

### [FR-001] 分析師團隊管理 (Analyst Management)

- **描述**：使用者可建立並維護一組具備特定專業背景（人設）的 AI 分析師。
- **觸發條件**：使用者點擊「分析師管理」標籤頁。
- **內容項**：
  - **新增/編輯**：名稱、頭像 (Emoji)、使用模型 (Model)、系統提示詞 (System Prompt)。
  - **刪除**：移除指定的分析師資料（需確認視窗）。
- **輸入**：分析師基本資料欄位。
- **輸出**：更新後的分析師清單。
- **限制**：資料儲存於瀏覽器本地資料庫 (IndexedDB)。

### [FR-002] 競技主題管理 (Theme Management)

- **描述**：提供常用競技主題的儲存與選擇，避免重複輸入。
- **觸發條件**：使用者在「發起競技」頁面輸入主題。
- **功能**：可儲存當前主題、從下拉選單選擇歷史主題、刪除已存主題。
- **輸出**：自動填入主題至輸入框。

### [FR-003] 競技發起與設定 (Arena Setup)

- **描述**：設定單次競技的各項參數。
- **輸入**：
  - **主題**：字串（例如：台積電法說會觀點）。
  - **分析師選擇**：從已建立的分析師中選擇 1 ~ 3 位。
  - **裁判模型**：選擇負責生成最終結論的模型。
- **限制**：至少需選擇 1 位分析師且輸入主題方能開始。

### [FR-004] 多輪分析執行流 (Execution Workflow)

- **描述**：系統自動引導 AI 執行分析任務，分為兩個主要輪次：
  - **第一輪：獨立觀點 (Initial View)**：各分析師在不參考他人的情況下針對主題撰寫分析。
  - **第二輪：參考觀點 (Reference View)**：各分析師閱讀第一輪其他人的觀點後，進行修正、補充或反駁。
- **輸出**：各輪次的即時生成文字串流 (Streaming Content)。

### [FR-005] 最終結論生成 (Verdict / Conclusion)

- **描述**：在所有分析師完成兩輪對話後，由指定的裁判模型根據所有對話紀錄產出最終綜合評論。
- **輸入**：所有分析師的兩輪分析紀錄。
- **輸出**：包含立場總結、風險警示、最終判決的結構化建議。

### [FR-006] 即時狀態監控 (Real-time Status Monitoring)

- **描述**：在 AI 生成過程中，UI 需顯示目前的執行進度與特定動作狀態。
- **狀態項目**：連線建立、處理中、開始生成、生成內容中、網頁搜尋中（如啟用 Search 工具）、完成。

### [FR-007] 系統 API 設定 (System API Settings)

- **描述**：設定 OpenAI API 連線必備參數。
- **輸入**：OpenAI API Key（儲存於 LocalStorage）。
- **限制**：需提供遮罩顯示，且資料不再伺服器端保存（純前端方案）。

## 4. 非功能需求 (Non-Functional Requirements)

- **效能**：UI 需支援 OpenAI Server-Sent Events (SSE) 串流輸出，確保長文生成時不卡頓。
- **持久化**：分析師與主題資料需支援離線儲存 (IndexedDB)，確保重新整理頁面後資料不丟失。
- **回應式設計 (RWD)**：介面應適配桌機與平板環境（基於 PrimeFlex）。
- **安全性**：API Key 僅保存在使用者瀏覽器本地，不經由任何第三方後端轉送。

## 5. 業務規則 (Business Rules)

- **分析師上限**：單次競技最多選擇 3 位分析師，以維持視覺排版與 API 消耗平衡。
- **循序執行**：流程必須嚴格遵守：第一輪全員完成 -> 第二輪全員完成 -> 裁判總結。

## 6. 邊界情境與例外情況 (Edge Cases & Exceptions)

- **API Key 無效**：發起競技時如 API 回傳 401，應導向設定頁面並提示錯誤。
- **分析師數量為零**：進競技場頁面時若無任何分析師，應提示引導至管理頁面。
- **API 額度耗盡/逾時**：若生成中斷，各分析師卡片應顯示錯誤圖示並允許手動重試（待實作）。
- **IndexedDB 初始化失敗**：瀏覽器不支援 IndexedDB 時應告知使用者改用現代瀏覽器。

## 7. 風險與待確認事項 (To-Be-Determined)

- **費用管理**：目前為純前端專案，無法限制單一使用者的 API 額度消費。
- **後端連結**：未來是否需要支援多裝置同步（將存儲改為雲端資料庫）。
- **模型列表更新**：目前主要手動或 API 回傳篩選，未來需考慮新模型（如 o1 等）的參數適配問題。
